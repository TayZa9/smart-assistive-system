<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistive Vision Dashboard</title>
    <meta name="description"
        content="Real-time assistive vision system dashboard with live object detection and AI-powered guidance.">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëÅÔ∏è</text></svg>">
    <link rel="stylesheet" href="/static/css/styles.css?v=9">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0"
        rel="stylesheet">
</head>

<body>


    <!-- Ambient background blobs -->
    <div class="ambient-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="glass-header">
            <div class="header-left">
                <div class="logo-icon">
                    <span class="material-symbols-rounded">visibility</span>
                </div>
                <div class="header-text">
                    <h1>Smart Assistive Vision</h1>
                    <p class="subtitle">Real-time AI-powered scene analysis</p>
                </div>
            </div>
            <div class="header-right">
                <div class="header-controls">
                    <div class="control-item" title="Toggle System Active State">
                        <span class="material-symbols-rounded" id="sys-toggle-icon">power_settings_new</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="system-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="control-item" title="Toggle Overlays">
                        <span class="material-symbols-rounded">layers</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="overlay-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="control-item" title="Manage Recognized Faces">
                        <button id="btn-manage-faces" class="icon-btn"
                            style="background: rgba(255,255,255,0.1); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; color: white; transition: all 0.2s;">
                            <span class="material-symbols-rounded">face</span>
                        </button>
                    </div>
                    <!-- User Profile Dropdown -->
                    <div class="user-profile">
                        <img id="user-avatar" src="" alt="Profile" class="avatar-img">
                        <div class="dropdown-menu">
                            <span id="user-name-display" class="dropdown-header">User</span>
                            <a href="/auth/logout" class="dropdown-item"><span
                                    class="material-symbols-rounded">logout</span>Logout</a>
                        </div>
                    </div>
                </div>

                <div id="system-status" class="status-badge">
                    <span class="status-dot">
                        <span class="status-dot-ring"></span>
                    </span>
                    <span id="status-text">Connecting...</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Video Feed Section -->
            <section class="video-section">
                <div class="video-container glass-card">
                    <img src="/video_feed" alt="Live Camera Feed" id="video-feed">
                    <div class="video-overlay-top">
                        <div class="live-badge">
                            <span class="live-dot"></span>
                            LIVE
                        </div>
                        <div class="fps-badge" id="fps-display">WAIT</div>
                    </div>
                    <div class="video-overlay-bottom">
                        <div class="detection-count-badge" id="detection-count">
                            <span class="material-symbols-rounded">frame_inspect</span>
                            <span id="det-count-text">0 objects</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sidebar -->
            <section class="sidebar">
                <!-- Detections Card -->
                <div class="glass-card detections-card">
                    <div class="card-header">
                        <span class="material-symbols-rounded card-icon">radar</span>
                        <h2>Live Detections</h2>
                    </div>
                    <ul id="detection-list">
                        <li class="empty-state">
                            <span class="material-symbols-rounded empty-icon">search</span>
                            <span>Waiting for detections...</span>
                        </li>
                    </ul>
                </div>

                <!-- LLM Guidance Card -->
                <div class="glass-card guidance-card">
                    <div class="card-header">
                        <span class="material-symbols-rounded card-icon">neurology</span>
                        <h2>AI Guidance</h2>
                    </div>
                    <div id="llm-output" class="guidance-content">
                        <p class="empty-state">
                            <span class="material-symbols-rounded empty-icon">psychology</span>
                            <span>AI reasoning will appear here...</span>
                        </p>
                    </div>

                </div>

                <!-- System Log Card -->
                <div class="glass-card logs-card">
                    <div class="card-header">
                        <span class="material-symbols-rounded card-icon">terminal</span>
                        <h2>Detected Objects</h2>
                    </div>
                    <div id="log-entries" class="log-content">
                        <p class="log-entry">System initialized ‚Äî waiting for data...</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="glass-footer">
            <div class="footer-left">
                <span class="material-symbols-rounded">smart_toy</span>
                <span>Powered by YOLOv26 + Gemini</span>
            </div>
            <div class="footer-right">
                <span id="timestamp"></span>
            </div>
        </footer>
    </div>
    </div>
    <!-- Ask AI FAB -->
    <button id="fab-ask-ai" class="fab-ask-ai" aria-label="Ask AI Memory">
        <span class="material-symbols-rounded">psychology_alt</span>
    </button>

    <!-- Ask AI Modal -->
    <div id="ask-modal" class="modal-overlay hidden">
        <div class="glass-card modal-content">
            <div class="modal-header">
                <h3>Ask Memory</h3>
                <button id="modal-close" class="modal-close-btn">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-with-mic">
                    <input type="text" id="modal-input" placeholder="e.g., 'Where are my keys?'" autocomplete="off">
                    <button id="modal-mic-btn" class="modal-mic-btn" title="Start listening">
                        <span class="material-symbols-rounded">mic</span>
                    </button>
                </div>
                <div id="modal-answer" class="modal-answer hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="modal-send-btn" class="modal-send-btn">
                    <span class="material-symbols-rounded">send</span>
                    Ask
                </button>
            </div>
        </div>
    </div>

    <!-- Manage Faces Modal -->
    <div id="faces-modal" class="modal-overlay hidden">
        <div class="glass-card modal-content faces-modal-content">
            <div class="modal-header">
                <h3><span class="material-symbols-rounded">face</span> Manage Faces</h3>
                <button class="modal-close-btn" id="faces-close">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-desc" style="margin-bottom: 1rem; color: #a0a0b0;">Add photos of people you know so the
                    system can recognize them.</p>

                <div class="add-face-form" style="display: flex; gap: 8px; margin-bottom: 1.5rem;">
                    <input type="text" id="face-name-input" class="glass-input" placeholder="Person's Name (e.g., Mom)">
                    <input type="file" id="face-file-input" accept="image/*" class="glass-input" style="padding: 8px;">
                    <button id="btn-upload-face" class="modal-send-btn" style="white-space: nowrap;"><span
                            class="material-symbols-rounded">upload</span> Upload</button>
                </div>

                <div class="faces-list" id="faces-list" style="max-height: 200px; overflow-y: auto;">
                    <!-- Loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js?v=12"></script>
</body>

</html>